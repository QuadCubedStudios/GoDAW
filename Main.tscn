[gd_scene load_steps=5 format=2]

[ext_resource path="res://Panels/PianoRoll/PianoRoll.tscn" type="PackedScene" id=1]
[ext_resource path="res://Theme/Default/GoDAWTheme.tres" type="Theme" id=2]
[ext_resource path="res://Panels/InstrumentList/InstrumentList.tscn" type="PackedScene" id=3]

[sub_resource type="GDScript" id=1]
script/source = "extends Control

onready var player = $AudioStreamPlayer
onready var instrument_tab = $VBoxContainer/EditorView/SideBar/Instruments/VBoxContainer/List

func _init():
	pass

func load_instruments():
	var dir = Directory.new()
	dir.open(\"res://Instruments\")
	dir.list_dir_begin(true, true)

	var instrument_name = dir.get_next()
	while instrument_name != \"\":
		if dir.file_exists(\"./%s/instrument.gd\" % instrument_name):
			var instrument = load(\"%s/%s/instrument.gd\" % [dir.get_current_dir(), instrument_name])
			GoDAW.register_instrument(instrument_name, instrument.new())
			
			if dir.file_exists(\"./%s/icon.png\" % instrument_name):
				instrument_tab.add_item(instrument_name, load(\"%s/%s/icon.png\" % [dir.get_current_dir(), instrument_name]))
			else:
				push_warning(\"Instrument %s does not have an icon.png file\" % instrument_name)
				instrument_tab.add_item(instrument_name, load(\"res://util/Theme/Default/defaultIcon.png\"))
		else:
			push_warning(\"Instrument %s does not have an instrument.gd file\" % instrument_name)

		instrument_name = dir.get_next()

func _ready():
	load_instruments()
	var osc = GoDAW.get_instrument(\"TripleOsc\")
	var wave = Wave.new(osc.create_sample())
	wave.position += Vector2(10, 200)
	wave.x_index=5
	#add_child(wave)
	# Set stream and play
	#player.stream = osc.create_sample()
	#player.play()
"

[node name="Main" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0
theme = ExtResource( 2 )
script = SubResource( 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="."]

[node name="VBoxContainer" type="VBoxContainer" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Menu" type="HBoxContainer" parent="VBoxContainer"]
margin_right = 1024.0
margin_bottom = 30.0

[node name="MenuButton" type="MenuButton" parent="VBoxContainer/Menu"]
margin_right = 39.0
margin_bottom = 30.0
text = "File"
items = [ "New", null, 0, false, false, 0, 0, null, "", false, "", null, 0, false, false, 1, 0, null, "", true, "Item 2", null, 0, false, false, 2, 0, null, "", false ]

[node name="EditorView" type="HBoxContainer" parent="VBoxContainer"]
margin_top = 34.0
margin_right = 1024.0
margin_bottom = 600.0
size_flags_horizontal = 3
size_flags_vertical = 3

[node name="SideBar" type="TabContainer" parent="VBoxContainer/EditorView"]
margin_right = 8.0
margin_bottom = 566.0
tab_align = 0

[node name="Instruments" parent="VBoxContainer/EditorView/SideBar" instance=ExtResource( 3 )]
margin_left = 4.0
margin_top = 32.0
margin_right = -4.0
margin_bottom = -4.0

[node name="Tab Workspace" type="TabContainer" parent="VBoxContainer/EditorView"]
margin_left = 12.0
margin_right = 20.0
margin_bottom = 566.0
tab_align = 0

[node name="Piano Roll" parent="VBoxContainer/EditorView/Tab Workspace" instance=ExtResource( 1 )]
margin_left = 4.0
margin_top = 32.0
margin_right = -4.0
margin_bottom = -4.0
